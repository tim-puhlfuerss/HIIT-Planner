<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <meta
      name="description"
      content="Generate HIIT workouts with random exercises and customizable rounds."
    />
    <title>HIIT Workout Planner</title>

    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
    />
    <link rel="stylesheet" href="stylesheet.css" />
    <script src="hiit_planner.js"></script>
  </head>
  <body>
    <header class="container">
      <hgroup>
        <br />
        <h1>HIIT Workout Planner</h1>
        <p>
          Generate HIIT workouts with random exercises and customizable rounds.
        </p>
      </hgroup>
    </header>
    <main class="container">
      <section>
        <form id="workoutForm">
          <details name="configuration">
            <summary role="button" class="outline">Configuration</summary>

            <fieldset class="container">
              <fieldset>
                <legend><strong>Exercise categories:</strong></legend>
                <div id="exerciseCategories"></div>
              </fieldset>

              <label for="rounds"><strong>Number of rounds:</strong></label>
              <fieldset role="group">
                <input
                  type="number"
                  id="rounds"
                  name="rounds"
                  min="1"
                  value="10"
                  required
                />
                <input
                  type="button"
                  id="roundsDecrease"
                  class="secondary"
                  value="-"
                />
                <input
                  type="button"
                  id="roundsIncrease"
                  class="secondary"
                  value="+"
                  aria-current="true"
                />
              </fieldset>

              <label for="categoryChange"
                ><strong>Rounds before category change:</strong></label
              >
              <fieldset role="group">
                <input
                  type="number"
                  id="categoryChange"
                  name="categoryChange"
                  min="1"
                  value="1"
                  required
                />
                <input
                  type="button"
                  id="categoryChangeDecrease"
                  class="secondary"
                  value="-"
                />
                <input
                  type="button"
                  id="categoryChangeIncrease"
                  class="secondary"
                  value="+"
                  aria-current="true"
                />
              </fieldset>
            </fieldset>
          </details>

          <details name="workout" open>
            <summary role="button" id="submit">Generate Workout</summary>
            <section>
              <div id="workoutOutput"></div>
            </section>
          </details>
        </form>
      </section>
    </main>
    <footer class="container">
      <p>
        <small
          >View project on
          <a
            href="https://github.com/tim-puhlfuerss/HIIT-Planner"
            target="_blank"
            >GitHub</a
          >. Built with
          <a href="https://picocss.com" target="_blank">Pico</a>.</small
        >
      </p>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        // Fetch exercise categories asynchronously and add them as checkboxes to the DOM
        let categoryCheckboxes = "";

        for (const cat of await getExerciseCategories()) {
          categoryCheckboxes += `<label><input type="checkbox" id="${cat.categoryName}" checked />${cat.emoji} ${cat.categoryName}</label>`;
        }

        document.getElementById("exerciseCategories").innerHTML =
          categoryCheckboxes;

        // Increase and decrease category change input
        const categoryChangeInput = document.getElementById("categoryChange");

        document
          .getElementById("categoryChangeIncrease")
          .addEventListener("click", () => {
            categoryChangeInput.value = parseInt(categoryChangeInput.value) + 1;
          });

        document
          .getElementById("categoryChangeDecrease")
          .addEventListener("click", () => {
            if (parseInt(categoryChangeInput.value) > 1) {
              categoryChangeInput.value =
                parseInt(categoryChangeInput.value) - 1;
            }
          });

        // Increase and decrease rounds input
        const roundsInput = document.getElementById("rounds");

        document
          .getElementById("roundsIncrease")
          .addEventListener("click", () => {
            roundsInput.value = parseInt(roundsInput.value) + 1;
          });

        document
          .getElementById("roundsDecrease")
          .addEventListener("click", () => {
            if (parseInt(roundsInput.value) > 1) {
              roundsInput.value = parseInt(roundsInput.value) - 1;
            }
          });
      });

      // Create workout based on input
      document
        .getElementById("submit")
        .addEventListener("click", async (event) => {
          event.preventDefault(); // Prevents closing of accordion

          // Get selected exercise categories
          const selectedCategories = Array.from(
            document
              .getElementById("exerciseCategories")
              .querySelectorAll("input[type='checkbox']:checked")
          ).map((checkbox) => checkbox.id);

          // Get number of rounds
          const rounds = parseInt(document.getElementById("rounds").value);

          // Get number of category changes
          const categoryChange = parseInt(
            document.getElementById("categoryChange").value
          );

          // Create workout and display exercises in a table
          if (selectedCategories.length > 0) {
            const workout = await createWorkout(
              selectedCategories,
              rounds,
              categoryChange
            );

            const outputDiv = document.getElementById("workoutOutput");
            outputDiv.innerHTML =
              '<table class="striped exercise-list"><tbody>' +
              workout
                .map(
                  (ex) => `<tr><td>${ex.emoji}</td><td>${ex.exercise}</td></tr>`
                )
                .join("") +
              "</tbody></table>";
          } else {
            document.getElementById("workoutOutput").innerHTML = "";
          }
        });
    </script>
  </body>
</html>
